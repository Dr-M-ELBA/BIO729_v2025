# Introduction

An image is worth a 1000 word. Images help us to capture features that are either difficult to articulate in words or numbers, or require lengthy descriptions. In the biomedical world, you will undoubtedly encounter images. Fortunately for us, AI is capable of interpreting images.
In this example, we will work with histology images of cancener cells. We will see some similarities in the code with the previous example but also differences.

# Code
First thing is to load the libraries needed to write the script. Can you add a comment to each library to briefly describe what it is:

```python
import numpy as np
import pandas as pd
import os
import shutil
from glob import glob 
import cv2
import gc 
import time
import matplotlib.pyplot as plt
import matplotlib.patches as patches
import seaborn as sns
from PIL import Image

````
Next, we need to mount our drive:

```python
drive.mount('/content/drive')
```

Since we are dealing with a relatively large file size, we will need to upload the file in a zip format. We will then need to unzip, which can be done by:

```python
!unzip Histology_example.zip
```

Now that our folder is readable, we need to assign the directory to variables to avoid writing the entire directories. Within our folder, we have two sub-folders.
One houses the positive images (i.e., images of cancer) and one houses the negative images. So let's do so:

```python
Pos_label = '/content/Histology_example/1'
Neg_label = '/content/Histology_example/0'
```
Now let's check to see how many images there are in each subfolder. There should be 12 and 13 for the positive and negative images, respectively:

```python
print('samples in positive label:', len(os.listdir(Pos_label)))
print('samples in negative label:', len(os.listdir(Neg_label)))
```

The above is as simple EDA as it gets, but important nonetheless. It's imperative to communicate with your partners to ensure that you have received the correct 
amount of, in this case, images before proceeding with your analysis. We can also represent the distribution graphically:

```python
pos_count = len([name for name in os.listdir(Pos_label) if os.path.isfile(os.path.join(Pos_label, name))])
neg_count = len([name for name in os.listdir(Neg_label) if os.path.isfile(os.path.join(Neg_label, name))])
data = {'Category': ['Positive', 'Negative'], 'Image Count': [pos_count, neg_count]}

sns.barplot(x='Category', y='Image Count', data=data)
plt.title('Image Distribution in Each Label')
plt.ylabel('Number of Images')
plt.xlabel('Group')
plt.show()
```

Let's double-check that we are working with the correct dataset by inspecting samples from each label:

```python
def plot_sample_images(directory, label):
    files = [file for file in os.listdir(directory) if os.path.isfile(os.path.join(directory, file))][:8]
    plt.figure(figsize=(20, 5))
    for i, file in enumerate(files):
        file_path = os.path.join(directory, file)
        try:
            with Image.open(file_path) as img:
                img_resized = img.resize((100, 100))
                plt.subplot(1, 8, i + 1)
                plt.imshow(img_resized)
                plt.title(f"{label} {i+1}")
                plt.axis('off')
        except Exception as e:
            print(f"Error processing file {file}: {e}")
    plt.suptitle(f"{label} Label Images", fontsize=16)
    plt.show()

if os.path.exists(Pos_label) and os.path.exists(Neg_label):
    print("Plotting Positive Label Images...")
    plot_sample_images(Pos_label, "Positive")

    print("Plotting Negative Label Images...")
    plot_sample_images(Neg_label, "Negative")
else:
    print("One or both directories do not exist. Please check the paths.")
```
Now a key EDA in image analysis are the colour distribution. There are several colour spaces, like CMYK and HSV, but the most common is RGB,
which stands for Red, Blue and Green. Most colours can be generated by varying the amount of red, blue and green. The following code will
calculate the frequency of each RGB and plot a boxplot for each label. Inspect the results and see if there are any noticeable differences:

```python
def calculate_rgb_values(directory):
    rgb_data = []
    for file in os.listdir(directory):
        file_path = os.path.join(directory, file)
        if os.path.isfile(file_path):
            try:
                with Image.open(file_path) as img:
                    img = img.resize((25, 25))  # Resize to reduce computation
                    img_array = np.array(img)
                    if len(img_array.shape) == 3 and img_array.shape[2] == 3:  # Ensure RGB image
                        r_mean = img_array[:, :, 0].mean()
                        g_mean = img_array[:, :, 1].mean()
                        b_mean = img_array[:, :, 2].mean()
                        rgb_data.append({'R': r_mean, 'G': g_mean, 'B': b_mean})
            except Exception as e:
                print(f"Error processing file {file}: {e}")
    return pd.DataFrame(rgb_data)

if os.path.exists(Pos_label) and os.path.exists(Neg_label):
    # Calculate RGB values for positive and negative labels
    print("Calculating RGB values for Positive Label...")
    pos_rgb_df = calculate_rgb_values(Pos_label)

    print("Calculating RGB values for Negative Label...")
    neg_rgb_df = calculate_rgb_values(Neg_label)

    fig, axes = plt.subplots(1, 2, figsize=(15, 7), sharey=True)

    sns.boxplot(data=pos_rgb_df, ax=axes[0])
    axes[0].set_title("Positive Label RGB Distribution")
    axes[0].set_ylabel("Intensity")
    axes[0].set_xlabel("Color Channel")

    sns.boxplot(data=neg_rgb_df, ax=axes[1])
    axes[1].set_title("Negative Label RGB Distribution")
    axes[1].set_xlabel("Color Channel")

    plt.tight_layout()
    plt.show()
else:
    print("One or both directories do not exist. Please check the paths.")
```

Other EDA include inspecting the brightness of each image to elucidate a difference between the two labels. Like before, we can represent the results
in text format:

```python
def calculate_brightest_and_darkest(directory):
    """Calculate the brightest and darkest pixel values for each image."""
    results = []
    for file in os.listdir(directory):
        file_path = os.path.join(directory, file)
        if os.path.isfile(file_path):
            try:
                with Image.open(file_path) as img:
                    img_array = np.array(img.convert('L'))  # Convert to grayscale
                    brightest = img_array.max()  # Maximum pixel value
                    darkest = img_array.min()    # Minimum pixel value
                    results.append((file, brightest, darkest))
            except Exception as e:
                print(f"Error processing file {file}: {e}")
    return results

def print_brightest_and_darkest(results):
    """Print the brightest and darkest pixel values for each image."""
    for file, brightest, darkest in results:
        print(f"Image {file} brightest pixel value is {brightest}, darkest pixel value is {darkest}")

# Check if directories exist
if os.path.exists(Pos_label) and os.path.exists(Neg_label):
    print("Processing Positive Label Images...")
    pos_results = calculate_brightest_and_darkest(Pos_label)
    print_brightest_and_darkest(pos_results)

    print("\nProcessing Negative Label Images...")
    neg_results = calculate_brightest_and_darkest(Neg_label)
    print_brightest_and_darkest(neg_results)
else:
    print("One or both directories do not exist. Please check the paths.")
```

But again, it's easier to detect differences if we represent the results graphically:
```python
def calculate_brightness_distribution(directory):
    """Calculate brightness values for all pixels in all images of a directory."""
    brightness_values = []
    for file in os.listdir(directory):
        file_path = os.path.join(directory, file)
        if os.path.isfile(file_path):
            try:
                with Image.open(file_path) as img:
                    img_array = np.array(img.convert('L'))  # Convert to grayscale
                    brightness_values.extend(img_array.flatten())  # Add all pixel values
            except Exception as e:
                print(f"Error processing file {file}: {e}")
    return brightness_values

# Check if directories exist
if os.path.exists(Pos_label) and os.path.exists(Neg_label):
    print("Calculating brightness for Positive Label...")
    pos_brightness = calculate_brightness_distribution(Pos_label)

    print("Calculating brightness for Negative Label...")
    neg_brightness = calculate_brightness_distribution(Neg_label)

    # Plot histogram
    plt.figure(figsize=(10, 6))
    plt.hist(pos_brightness, bins=50, color='orange', alpha=0.7, label='Positive Label')
    plt.hist(neg_brightness, bins=50, color='blue', alpha=0.7, label='Negative Label')
    plt.title('Brightness Distribution for Positive and Negative Labels')
    plt.xlabel('Brightness (Pixel Intensity)')
    plt.ylabel('Frequency')
    plt.legend()
    plt.tight_layout()
    plt.show()
```

The above provides an example of the type of EDA applied to image datasets. There are several more, with a key one being inspecting the image size.
Remember that in machine learning, we need to make sure we have the same vector length for each sample. In the context of images, that means an ML
model will not work if some of your images as 25 x 25 pixels and others are 1024 x 1024 pixels as inputs.

